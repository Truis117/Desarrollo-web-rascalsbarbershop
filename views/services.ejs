<%- include('partials/head', { title: "Servicios ‚Äî Clip & Fade" }) %>
    <%- include('partials/header') %>

        <main id="main" class="site-main" role="main">
            <section id="services" class="services" aria-labelledby="services-heading">
                <div class="container">
                    <h3 id="services-heading">Nuestros Servicios</h3>
                    <ul class="service-list" id="service-list">
                        <li style="text-align: center; padding: 2rem; color: #666;">
                            Cargando servicios...
                        </li>
                    </ul>
                </div>
            </section>
        </main>

        <!-- Modal de Detalles del Servicio -->
        <div id="service-modal" class="modal">
            <div class="modal-content">
                <span class="modal-close">&times;</span>
                <div class="modal-body">
                    <div class="modal-header">
                        <h2 id="modal-title">Nombre del Servicio</h2>
                        <p class="modal-price" id="modal-price">$0</p>
                    </div>
                    <div class="modal-details">
                        <div class="detail-section">
                            <h4>üìù Descripci√≥n</h4>
                            <p id="modal-description">Descripci√≥n del servicio...</p>
                        </div>
                        <div class="detail-section">
                            <h4>‚ú® Beneficios</h4>
                            <ul id="modal-benefits"></ul>
                        </div>
                        <div class="detail-section">
                            <h4>‚úÖ Incluye</h4>
                            <ul id="modal-includes"></ul>
                        </div>
                        <div class="detail-section">
                            <h4>‚è±Ô∏è Duraci√≥n</h4>
                            <p id="modal-duration">0 minutos</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="/booking" class="btn-primary">Reservar Ahora</a>
                    </div>
                </div>
            </div>
        </div>

        <%- include('partials/footer') %>

        <style>
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.7);
                animation: fadeIn 0.3s ease-out;
            }

            .modal-content {
                background-color: #fefefe;
                margin: 5% auto;
                padding: 0;
                border-radius: 8px;
                width: 90%;
                max-width: 600px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                animation: slideDown 0.3s ease-out;
            }

            .modal-close {
                color: #aaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
                padding: 10px 20px;
                cursor: pointer;
            }

            .modal-close:hover { color: #000; }

            .modal-body { padding: 30px; }

            .modal-header {
                border-bottom: 2px solid #333;
                padding-bottom: 15px;
                margin-bottom: 20px;
            }

            .modal-header h2 { margin: 0 0 10px 0; color: #333; }

            .modal-price {
                font-size: 24px;
                font-weight: bold;
                color: #d4af37;
                margin: 0;
            }

            .detail-section { margin-bottom: 20px; }
            .detail-section h4 { color: #333; margin-bottom: 10px; }
            .detail-section p { color: #666; line-height: 1.6; }
            .detail-section ul { list-style: none; padding: 0; }
            .detail-section ul li {
                padding: 5px 0 5px 20px;
                position: relative;
                color: #666;
            }
            .detail-section ul li:before {
                content: "‚úì";
                position: absolute;
                left: 0;
                color: #d4af37;
                font-weight: bold;
            }

            .modal-footer {
                text-align: center;
                padding-top: 20px;
                border-top: 1px solid #eee;
            }

            .btn-primary {
                background-color: #d4af37;
                color: #1a1a1a;
                padding: 12px 30px;
                text-decoration: none;
                border-radius: 4px;
                font-weight: bold;
                display: inline-block;
                transition: background-color 0.3s;
            }

            .btn-primary:hover { background-color: #b8941f; }

            .btn-details {
                background-color: #333;
                color: #fff;
                padding: 8px 16px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                margin-top: 10px;
                transition: background-color 0.3s;
            }

            .btn-details:hover { background-color: #555; }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes slideDown {
                from { transform: translateY(-50px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        </style>

        <script>
            async function loadServices() {
                try {
                    const response = await fetch('/api/servicios');
                    const servicios = await response.json();
                    const serviceList = document.getElementById('service-list');
                    
                    if (!servicios || servicios.length === 0) {
                        serviceList.innerHTML = '<li style="text-align: center; padding: 2rem; color: #666;">No hay servicios disponibles</li>';
                        return;
                    }

                    serviceList.innerHTML = servicios.map(servicio => `
                        <li>
                            <article class="service">
                                <h4>${servicio.nombre_servicio}</h4>
                                <p>${servicio.descripcion || 'Servicio profesional de barber√≠a'}</p>
                                <p class="meta">${servicio.duracion} mins ‚Äî $${parseFloat(servicio.precio).toLocaleString()}</p>
                                <button class="btn-details" onclick="openServiceModal(${servicio.id_servicio})">Ver Detalles</button>
                            </article>
                        </li>
                    `).join('');

                    window.serviciosData = servicios;
                } catch (error) {
                    console.error('Error:', error);
                    document.getElementById('service-list').innerHTML = '<li style="text-align: center; padding: 2rem; color: #e74c3c;">Error al cargar servicios</li>';
                }
            }

            function openServiceModal(servicioId) {
                const servicio = window.serviciosData.find(s => s.id_servicio === servicioId);
                if (!servicio) return;

                document.getElementById('modal-title').textContent = servicio.nombre_servicio;
                document.getElementById('modal-price').textContent = `$${parseFloat(servicio.precio).toLocaleString()}`;
                document.getElementById('modal-description').textContent = servicio.descripcion_larga || servicio.descripcion || 'Servicio profesional';
                document.getElementById('modal-duration').textContent = `${servicio.duracion} minutos`;

                const beneficiosList = document.getElementById('modal-benefits');
                if (servicio.beneficios) {
                    beneficiosList.innerHTML = servicio.beneficios.split(',').map(b => `<li>${b.trim()}</li>`).join('');
                } else {
                    beneficiosList.innerHTML = '<li>Servicio de calidad profesional</li>';
                }

                const includesList = document.getElementById('modal-includes');
                if (servicio.incluye) {
                    includesList.innerHTML = servicio.incluye.split(',').map(i => `<li>${i.trim()}</li>`).join('');
                } else {
                    includesList.innerHTML = '<li>Servicio completo</li>';
                }

                document.getElementById('service-modal').style.display = 'block';
            }

            document.querySelector('.modal-close').onclick = () => document.getElementById('service-modal').style.display = 'none';
            window.onclick = (e) => { if (e.target.id === 'service-modal') e.target.style.display = 'none'; };
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape') document.getElementById('service-modal').style.display = 'none'; });
            document.addEventListener('DOMContentLoaded', loadServices);
        </script>
